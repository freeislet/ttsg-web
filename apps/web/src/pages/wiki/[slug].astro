---
import { fetchWikiContent } from '@/utils/wiki'
import Layout from '@/layouts/Layout.astro'

export const prerender = false // Disable prerendering for dynamic routes

const { slug } = Astro.params
const wikiContent = await fetchWikiContent(slug || 'index')

// Add metadata for proper SEO
const title = wikiContent.title || 'Wiki Page'
const description = `TTSG Wiki - ${title}`
---

<Layout title={title} description={description}>
  <div class="container mx-auto px-4 py-8">
    <div class="mb-6">
      <div class="flex items-center justify-between">
        <h1 class="text-3xl font-bold">{title}</h1>
        {
          wikiContent.source === 'r2' && (
            <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">
              Remote
            </span>
          )
        }
      </div>
      <div class="border-b mt-2 mb-6"></div>
    </div>

    <div class="prose max-w-none">
      <!-- Wiki content rendered as HTML -->
      <Fragment set:html={wikiContent.html} />
    </div>

    {
      wikiContent.source === 'not-found' && (
        <div class="mt-8 p-4 border border-yellow-400 bg-yellow-50 rounded">
          <h3 class="text-lg font-medium">Content Not Found</h3>
          <p>The requested wiki page could not be found. Would you like to create it?</p>
          <a
            href="#"
            class="inline-block mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
          >
            Create Page
          </a>
        </div>
      )
    }
  </div>
</Layout>
