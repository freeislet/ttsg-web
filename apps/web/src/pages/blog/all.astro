---
import { getCollection } from 'astro:content'
import Layout from '@/layouts/Layout.astro'
import Header from '@/components/Header.astro'
import Footer from '@/components/Footer.astro'
import BlogHeader from '@/components/blog/BlogHeader.astro'
import BlogList from '@/components/blog/BlogList.astro'
import { categoryData } from '@/types/blog'
import { pageSEO } from '@/lib/seo/config'

// 모든 블로그 포스트 가져오기
const allPosts = await getCollection('blog')

// 발행된 포스트만 필터링 및 정렬
const publishedPosts = allPosts
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())

// 카테고리별 통계
const categoryStats = Object.keys(categoryData).reduce(
  (stats, category) => {
    stats[category] = publishedPosts.filter((post) => post.data.category === category).length
    return stats
  },
  {} as Record<string, number>
)

const pageTitle = '전체 포스트 | TTSG'
const pageDescription = 'TTSG 블로그의 모든 포스트를 한눈에 확인해보세요.'

const seo = {
  ...pageSEO.blog,
  title: pageTitle,
  description: pageDescription,
  url: '/blog/all',
  type: 'website' as const,
}
---

<Layout seo={seo}>
  <Header />

  <main class="min-h-screen bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 py-8">
      <BlogHeader title="모든 포스트" count={publishedPosts.length} currentPage="all" />
      <BlogList posts={publishedPosts} />
    </div>
  </main>

  <Footer />
</Layout>
