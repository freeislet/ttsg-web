---
import { getCollection } from 'astro:content'
import Layout from '@/layouts/Layout.astro'
import Header from '@/components/Header.astro'
import Footer from '@/components/Footer.astro'
import BlogList from '@/components/blog/BlogList.astro'
import type { Category } from '@/types/blog'
import { categoryNamesDetailed } from '@/types/blog'

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog')
  const publishedPosts = blogPosts.filter((post) => !post.data.draft)

  // 카테고리별로 그룹화
  const categories = [...new Set(publishedPosts.map((post) => post.data.category))]

  return categories.map((category) => ({
    params: { category },
    props: {
      posts: publishedPosts.filter((post) => post.data.category === category),
      category,
    },
  }))
}

const { posts, category } = Astro.props

const categoryDescriptions: Record<Category, string> = {
  tech: '개발 관련 기술 문서, 튜토리얼, 그리고 실무 경험을 공유합니다.',
  news: '최신 업계 동향, 제품 소식, 그리고 중요한 발표 내용을 전해드립니다.',
  intro: 'TTSG의 제품, 서비스, 그리고 팀에 대한 소개글을 확인하세요.',
}

const seoTitle = `${categoryNamesDetailed[category as Category]} | TTSG 블로그`
const seoDescription = `TTSG 블로그의 ${categoryNamesDetailed[category as Category]} 카테고리입니다. ${categoryDescriptions[category as Category]}`
---

<Layout title={seoTitle} description={seoDescription}>
  <Header />

  <main class="min-h-screen bg-gray-50">
    <!-- 카테고리 헤더 -->
    <section class="bg-white border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 py-12">
        <div class="text-center">
          <!-- 브레드크럼 -->
          <nav class="flex justify-center mb-6" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2 text-sm">
              <li>
                <a href="/" class="text-gray-500 hover:text-gray-700">홈</a>
              </li>
              <li>
                <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    fill-rule="evenodd"
                    d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                    clip-rule="evenodd"></path>
                </svg>
              </li>
              <li>
                <a href="/blog" class="text-gray-500 hover:text-gray-700">블로그</a>
              </li>
              <li>
                <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    fill-rule="evenodd"
                    d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                    clip-rule="evenodd"></path>
                </svg>
              </li>
              <li class="text-gray-900 font-medium">
                {categoryNamesDetailed[category as Category]}
              </li>
            </ol>
          </nav>

          <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
            {categoryNamesDetailed[category as Category]}
          </h1>
          <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
            {categoryDescriptions[category as Category]}
          </p>

          <!-- 포스트 수 표시 -->
          <div class="inline-flex items-center px-4 py-2 rounded-full bg-gray-100 text-gray-700">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              ></path>
            </svg>
             총 {posts.length}개의 포스트
          </div>
        </div>
      </div>
    </section>

    <!-- 포스트 목록 -->
    <div class="max-w-7xl mx-auto px-4 py-8">
      <BlogList posts={posts} category={category} />

      <!-- 다른 카테고리 링크 -->
      <section class="mt-16 pt-8 border-t border-gray-200">
        <h2 class="text-xl font-bold text-gray-900 mb-6 text-center">다른 카테고리도 둘러보세요</h2>
        <div class="flex flex-wrap justify-center gap-4">
          {
            Object.entries(categoryNamesDetailed).map(
              ([cat, name]) =>
                cat !== category && (
                  <a
                    href={`/blog/category/${cat}`}
                    class="inline-flex items-center px-6 py-3 border border-gray-300 rounded-lg text-base font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-400 transition-colors duration-200"
                  >
                    {name}
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      />
                    </svg>
                  </a>
                )
            )
          }
          <a
            href="/blog"
            class="inline-flex items-center px-6 py-3 border border-blue-300 rounded-lg text-base font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 hover:border-blue-400 transition-colors duration-200"
          >
            전체 블로그 보기
            <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"
              ></path>
            </svg>
          </a>
        </div>
      </section>
    </div>
  </main>

  <Footer />
</Layout>
