---
import { getCollection } from 'astro:content'
import Layout from '@/layouts/Layout.astro'
import Header from '@/components/Header.astro'
import Footer from '@/components/Footer.astro'
import BlogList from '@/components/blog/BlogList.astro'
import { categories, categoryData, type Category } from '@/types/blog'
import { pageSEO } from '@/lib/seo/config'

// ëª¨ë“  ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (draftê°€ ì•„ë‹Œ ê²ƒë§Œ)
const _allPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true
})

// ë°œí–‰ì¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ìˆœ)
const allPosts = _allPosts.sort(
  (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
)

const seo = {
  ...pageSEO.blog,
  url: '/blog',
  type: 'website' as const,
}
---

<Layout seo={seo}>
  <Header />

  <main class="min-h-screen bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 py-8">
      <!-- í—¤ë” ì„¹ì…˜ -->
      <header class="text-center mb-8">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">TTSG ë¸”ë¡œê·¸</h1>
      </header>

      <!-- ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ê²Œì´ì…˜ -->
      <nav class="mb-8">
        <div class="flex flex-wrap justify-center gap-4">
          <a href="/blog/featured" class="blog-nav-button">â­ ì¶”ì²œ í¬ìŠ¤íŠ¸</a>
          <a href="/blog/all" class="blog-nav-button">ğŸ“š ëª¨ë“  í¬ìŠ¤íŠ¸</a>
          {
            Object.entries(categoryData).map(([key, category]) => (
              <a href={`/blog/category/${key}`} class="blog-nav-button">
                {category.name}
              </a>
            ))
          }
        </div>
      </nav>

      <!-- ì¶”ì²œ í¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
      <BlogList
        posts={allPosts}
        title="â­ ì¶”ì²œ í¬ìŠ¤íŠ¸"
        featured={true}
        maxPosts={6}
        viewAllHref="/blog/featured"
      />

      <!-- ìµœì‹  í¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
      <BlogList posts={allPosts} title="ìµœì‹  í¬ìŠ¤íŠ¸" maxPosts={6} viewAllHref="/blog/all" />

      <!-- ì¹´í…Œê³ ë¦¬ë³„ ë¯¸ë¦¬ë³´ê¸° -->
      {
        categories.map((category: Category) => (
          <div class="mt-16">
            <BlogList
              posts={allPosts}
              title={categoryData[category].name}
              category={category}
              compact={true}
              maxPosts={6}
              viewAllHref={`/blog/category/${category}`}
            />
          </div>
        ))
      }
    </div>
  </main>

  <Footer />
</Layout>
