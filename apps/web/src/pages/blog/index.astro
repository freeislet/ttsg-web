---
import { getCollection } from 'astro:content'
import Layout from '@/layouts/Layout.astro'
import Header from '@/components/Header.astro'
import Footer from '@/components/Footer.astro'
import BlogHeader from '@/components/blog/BlogHeader.astro'
import BlogList from '@/components/blog/BlogList.astro'
import { categories, categoryData, type Category } from '@/types/blog'
import { pageSEO } from '@/lib/seo/config'

// 모든 블로그 포스트 가져오기 (draft가 아닌 것만)
const _allPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true
})

// 발행일 기준으로 정렬 (최신순)
const allPosts = _allPosts.sort(
  (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
)

const seo = {
  ...pageSEO.blog,
  url: '/blog',
  type: 'website' as const,
}
---

<Layout seo={seo}>
  <Header />

  <main class="min-h-screen bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 py-8">
      <BlogHeader title="TTSG 블로그" />

      <!-- 추천 포스트 섹션 -->
      <BlogList
        posts={allPosts}
        title="⭐ 추천 포스트"
        featured={true}
        maxPosts={6}
        viewAllHref="/blog/featured"
      />

      <!-- 최신 포스트 섹션 -->
      <BlogList posts={allPosts} title="최신 포스트" maxPosts={6} viewAllHref="/blog/all" />

      <!-- 카테고리별 미리보기 -->
      {
        categories.map((category: Category) => (
          <div class="mt-16">
            <BlogList
              posts={allPosts}
              title={categoryData[category].detailedName}
              category={category}
              compact={true}
              maxPosts={6}
              viewAllHref={`/blog/category/${category}`}
            />
          </div>
        ))
      }
    </div>
  </main>

  <Footer />
</Layout>
