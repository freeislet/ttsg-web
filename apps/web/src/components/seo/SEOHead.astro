---
import type { SEOData } from '@/types/seo'
import { seoToOpenGraph, seoToTwitterCard, formatSEOTitle, truncateDescription, toAbsoluteURL, keywordsToString } from '@/lib/seo/utils'
import { defaultSEO } from '@/lib/seo/config'
import OpenGraph from './OpenGraph.astro'
import TwitterCard from './TwitterCard.astro'
import JsonLD from './JsonLD.astro'

export interface Props {
  seo?: Partial<SEOData>;
}

const { seo = {} } = Astro.props;

// 기본값과 전달받은 SEO 데이터 병합
const mergedSEO: SEOData = {
  ...defaultSEO,
  ...seo,
  title: formatSEOTitle(seo.title || defaultSEO.title),
  description: truncateDescription(seo.description || defaultSEO.description),
  url: toAbsoluteURL(seo.url || Astro.url.pathname),
  image: seo.image ? toAbsoluteURL(seo.image) : toAbsoluteURL(defaultSEO.image),
}

// Open Graph 및 Twitter Card 데이터 생성
const ogData = seoToOpenGraph(mergedSEO)
const twitterData = seoToTwitterCard(mergedSEO)
---

<!-- 기본 메타태그 -->
<title>{mergedSEO.title}</title>
<meta name="description" content={mergedSEO.description} />
{mergedSEO.keywords && (
  <meta name="keywords" content={keywordsToString(mergedSEO.keywords)} />
)}

<!-- 캐노니컬 URL -->
<link rel="canonical" href={mergedSEO.url} />

<!-- 언어 설정 -->
<meta name="language" content="ko" />
<meta http-equiv="content-language" content="ko" />

<!-- 로봇 메타태그 -->
<meta name="robots" content="index, follow" />
<meta name="googlebot" content="index, follow" />

<!-- 작성자 정보 -->
{mergedSEO.author && (
  <meta name="author" content={mergedSEO.author} />
)}

<!-- 발행일/수정일 -->
{mergedSEO.publishedTime && (
  <meta name="article:published_time" content={mergedSEO.publishedTime} />
)}
{mergedSEO.modifiedTime && (
  <meta name="article:modified_time" content={mergedSEO.modifiedTime} />
)}

<!-- Open Graph 메타태그 -->
<OpenGraph data={ogData} />

<!-- Twitter Card 메타태그 -->
<TwitterCard data={twitterData} />

<!-- JSON-LD 구조화된 데이터 -->
<JsonLD seo={mergedSEO} />

<!-- 추가 메타태그 -->
<meta name="format-detection" content="telephone=no" />
<meta name="theme-color" content="#3b82f6" />

<!-- 파비콘 및 아이콘 -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />

<!-- 사이트맵 -->
<link rel="sitemap" href="/sitemap.xml" />

<!-- RSS 피드 (향후 추가 예정) -->
<!-- <link rel="alternate" type="application/rss+xml" title="TTSG RSS Feed" href="/rss.xml" /> -->
