---
import BlogCard from './BlogCard.astro'
import type { CollectionEntry } from 'astro:content'
import type { Category } from '@/types/blog'
import { categoryData } from '@/types/blog'

export interface Props {
  posts: CollectionEntry<'blog'>[]
  title?: string
  category?: Category
  featured?: boolean
  maxPosts?: number
  compact?: boolean
  viewAllHref?: string
}

const {
  posts,
  title,
  category,
  featured = false,
  maxPosts,
  compact = false,
  viewAllHref,
} = Astro.props

// 포스트 필터링 및 정렬
let filteredPosts = posts //.filter((post) => !post.data.draft)

if (category) {
  filteredPosts = filteredPosts.filter((post) => post.data.category === category)
}

if (featured) {
  filteredPosts = filteredPosts.filter((post) => post.data.featured)
}

// 발행일 기준 내림차순 정렬
// filteredPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())

// maxPosts가 설정된 경우 제한
if (maxPosts) {
  filteredPosts = filteredPosts.slice(0, maxPosts)
}
---

<section class={compact ? '' : 'py-8'}>
  <!-- 섹션 헤더 -->
  {
    (title || category) && (
      <div class="flex items-center gap-4 mb-6">
        <h2 class="text-3xl font-bold text-gray-900">
          {title || (category && categoryData[category].detailedName) || '블로그 포스트'}
        </h2>
        {viewAllHref && (
          <a href={viewAllHref} class="text-blue-600 hover:text-blue-800 font-medium text-sm">
            전체 보기 →
          </a>
        )}
      </div>
    )
  }

  <!-- 포스트 목록 -->
  {
    filteredPosts.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {filteredPosts.map((post) => (
          <BlogCard
            title={post.data.title}
            description={post.data.description}
            pubDate={post.data.pubDate}
            category={post.data.category}
            tags={post.data.tags}
            slug={post.slug}
            heroImage={post.data.heroImage}
            featured={post.data.featured}
            compact={compact}
          />
        ))}
      </div>
    ) : (
      <div class="text-center py-12">
        <h3 class="text-lg font-medium text-gray-900 mb-2">
          {category
            ? `${categoryData[category].detailedName} 포스트가 없습니다`
            : '포스트가 없습니다'}
        </h3>
      </div>
    )
  }
</section>
